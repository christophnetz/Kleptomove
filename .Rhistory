type <- c("fixd", "forg", "flex")
# get the replicates
replicates <- str_pad(seq_len(10), pad = "0", width=3)
# get the replicates
replicates <- stringr::str_pad(seq_len(10), pad = "0", width=3)
# get layers
layers <- c("items", "foragers", "klepts", "klepts_intake", "foragers_intake")
# glue data file names together
data_files <- tidyr::crossing(
which_gen,
type,
replicates,
layers
)
data_files$filepath <- glue_data(.x = data_files,
'{data_folder}/simstrat_{type}_\\
{replicates}/{which_gen}{layers}.txt')
# split by layer and replicate
data <- data_files %>%
split(data_files$type) %>%
map(function(l) {
l %>%
split(l$layers) %>%
map(function(l) {
l %>%
split(l$replicates) %>%
map(function(r) {
r$filepath
})
})
})
# read in data and get mean of layers per replicate
data <- map_depth(data, 4, read.matrix) %>%
map_depth(3, function(gens) {
reduce(gens, .f = `+`) / length(gens)
})
# convert to dataframe for capacity wise mean
data <- map_depth(data, 3, function(reps) {
# convert with colnames
data_reps <- data.table::data.table(reps)
data.table::setnames(data_reps, as.character(seq_len(128)))
# assign y coord
data_reps[, y := as.character(seq_len(128))]
# now melt
data_reps <- data.table::melt.data.table(data_reps,
id.vars = "y",
variable.name = "x")
# fix x coord
data_reps[, x := as.character(x)]
return(data_reps)
})
# get capacity wise mean
data <- map_depth(data, 3, function(reps) {
# merge capacity
reps <- merge(reps, capacity)
# # summarise
# reps <- reps[, .(mean = mean(value),
#                  sd = sd(value)),
#              by = cell_capacity]
})
# assign rep number and layer name
data <- map_depth(data, 2, function(l) {
map2(l, names(l), function(z1, z2) {
z1[, repl := z2]
})
}) %>%
map_depth(2, data.table::rbindlist)
# assign layer and sim type names
data <- imap(data, function(x, v) {
map2(x, names(x), function(z, w) {
z[, `:=` (type = v,
layer = w)]
})
})
# get final data for plotting
data <- map(data, rbindlist) %>%
rbindlist()
data[, layer := forcats::fct_relevel(layer,
c("klepts", "foragers", "items",
"klepts_intake", "foragers_intake"))]
data[, type := forcats::fct_relevel(type,
"forg", "fixd", "flex")]
data2 <- dcast(data,
type + repl + cell_capacity  ~ layer,
fun.aggregate = mean, value.var = "value")
data2[, `:=`(pc_int_klept = klepts_intake / klepts,
pc_int_forager = foragers_intake / foragers)]
# get per capita intake
data2[, `:=`(pc_int_klept = ifelse(klepts_intake == 0, 0, pc_int_klept),
pc_int_forager = ifelse(foragers_intake == 0, 0, pc_int_forager))]
# melt for facetting with items
data2 <- melt(data2, id.vars = c("type", "repl", "cell_capacity"))
# separate by intake
data2[, type2 := dplyr::case_when(
stringr::str_detect(variable, "intake") ~ "intake",
stringr::str_detect(variable, "item") ~ "items",
stringr::str_detect(variable, "pc") ~ "per_capita_intake",
TRUE ~ "strategy count"
)]
#### figure agent strategy distributions ####
fig_strat_distr <- data2[type2 == "strategy count", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::coolwarm(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
xlim(0, 4)+
ylim(0, 5)+
labs(x = "cell capacity (# items)",
y = "# agents (median)")
})
patchwork::wrap_plots(fig_strat_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
#### figure agent strategy distributions ####
fig_strat_distr <- data2[type2 == "strategy count", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::coolwarm(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
# ylim(0, 5)+
labs(x = "cell capacity (# items)",
y = "# agents (median)")
})
#### figure agent strategy distributions ####
fig_strat_distr <- data2[type2 == "strategy count", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::coolwarm(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
# ylim(0, 5)+
labs(x = "cell capacity (# items)",
y = "# agents (median)")
})
patchwork::wrap_plots(fig_strat_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
ggsave(filename = "figures/fig_agent_strat_distribution.png",
dpi = 300, width = 9, height = 4)
#### figure agent strategy distributions ####
fig_strat_distr <- data2[type2 == "strategy count", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::coolwarm(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
ylim(0, 11)+
labs(x = "cell capacity (# items)",
y = "# agents (median)")
})
patchwork::wrap_plots(fig_strat_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
ggsave(filename = "figures/fig_agent_strat_distribution.png",
dpi = 300, width = 9, height = 4)
#### figure item distributions ####
fig_item_distr <- data2[type2 == "items", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value / (100 * 10),
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value / (100 * 10),
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = "forest green")+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
# ylim(0, 0.5)+
labs(x = "cell capacity (# items)",
y = "# items (median / 100 t / 10 g)")
})
patchwork::wrap_plots(fig_item_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
#### figure item distributions ####
fig_item_distr <- data2[type2 == "items", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value / (100 * 10),
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value / (100 * 10),
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = "forest green")+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
# ylim(0, 0.5)+
labs(x = "cell capacity (# items)",
y = "# items (median / 100 t / 10 g)")
})
patchwork::wrap_plots(fig_item_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
fig_item_distr[[1]]
fig_item_distr[[2]]
fig_item_distr[[3]]
#### figure item distributions ####
fig_item_distr <- data2[type2 == "items", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value / (100 * 10),
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value / (100 * 10),
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = "forest green")+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
ylim(0, 0.5)+
labs(x = "cell capacity (# items)",
y = "# items (median / 100 t / 10 g)")
})
#### figure item distributions ####
fig_item_distr <- data2[type2 == "items", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value / (100 * 10),
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value / (100 * 10),
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = "forest green")+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
ylim(0, 0.5)+
labs(x = "cell capacity (# items)",
y = "# items (median / 100 t / 10 g)")
})
#### figure item distributions ####
fig_item_distr <- data2[type2 == "items", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value / (100 * 10),
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value / (100 * 10),
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = "forest green")+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
ylim(0, 0.5)+
labs(x = "cell capacity (# items)",
y = "# items (median / 100 t / 10 g)")
})
patchwork::wrap_plots(fig_item_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
ggsave(filename = "figures/fig_item_density_distribution.png",
dpi = 300, width = 9, height = 4)
#### figure item distributions ####
fig_item_distr <- data2[type2 == "items", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value / (100 * 10),
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value / (100 * 10),
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = "forest green")+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
ylim(0, 0.4)+
labs(x = "cell capacity (# items)",
y = "# items (median / 100 t / 10 g)")
})
patchwork::wrap_plots(fig_item_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
ggsave(filename = "figures/fig_item_density_distribution.png",
dpi = 300, width = 9, height = 4)
#### figure per capita intake ####
fig_pc_intake <- data2[type2 %in% c("per_capita_intake"), ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::kovesi.diverging_cwm_80_100_c22(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
xlim(0, 4)+
ylim(0, 0.4)+
labs(x = "cell capacity (# items)",
y = "# items (median)")
})
patchwork::wrap_plots(fig_pc_intake)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
#### figure per capita intake ####
fig_pc_intake <- data2[type2 %in% c("per_capita_intake"), ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::kovesi.diverging_cwm_80_100_c22(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
xlim(0, 4)+
ylim(0, 0.2)+
labs(x = "cell capacity (# items)",
y = "# items (median)")
})
patchwork::wrap_plots(fig_pc_intake)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
ggsave(filename = "figures/fig_pc_intake.png",
dpi = 300, width = 9, height = 4)
#### figure agent strategy distributions ####
fig_strat_distr <- data2[type2 == "strategy count", ] %>%
split(by = c("type")) %>%
map(function(d) {
ggplot(d)+
geom_line(aes(cell_capacity,
value,
group = interaction(variable, type, repl),
col = variable))+
geom_point(aes(cell_capacity,
value,
group = repl,
col = variable),
shape = 16, size = 2)+
scale_colour_manual(values = rev(pals::coolwarm(2)))+
theme_bw()+
theme(panel.grid.minor = element_blank(),
legend.position = "top",
plot.background = element_rect(fill = NA,
colour = "grey",
linetype = 3))+
facet_grid(type2~type,
scales = "free_y")+
# xlim(0, 4)+
ylim(0, 11)+
labs(x = "cell capacity (# items)",
y = "# agents (median)")
})
patchwork::wrap_plots(fig_strat_distr)+
patchwork::plot_annotation(tag_levels = "A")+
theme(plot.tag = element_text(face = "bold"))
ggsave(filename = "figures/fig_agent_strat_distribution.png",
dpi = 300, width = 9, height = 4)
head(data2)
data3 = copy(data2)
data3
fwrite(data, file = "data/data_full.csv")
